<!DOCTYPE html>
<html>
	<head>
		<meta charset="ISO-8859-1">
		<title>Submit Grade</title>
		<link rel="stylesheet" type="text/css" href="stylesheet.css">
	</head>
	<body>
		<div class="box">
		<h2 class="titles" style="line-height: 15px;"><u>Grade Submission</u></h2>
		<form class="text">
			<label for="grade"><b>Grade:</b></label><br>
			<input type="number"
				step="1" min="0" name="grade" id="grade" required
				placeholder="Points"> <label id="max_value"></label><br><br>
			<label for="comments"><b>Comments:</b></label><br> 
			<textarea name="comments" id="comments" rows="5" cols="20"></textarea><br><br>
			<button class="square" type="submit" id="submitButton">Submit</button>
		</form><br>
		</div>
		<script type="text/javascript">
			let xhr = new XMLHttpRequest();
			xhr.onreadystatechange = () => {
			    if (xhr.readyState === 4 && xhr.status === 200) {
			        document.getElementById("max_value").innerHTML = "/ " + xhr.responseText;
			        document.getElementById("grade").setAttribute("max", parseInt(xhr.responseText, 10));
			    }
			};
			xhr.open("GET", "grade-submission");
			xhr.send();
			

		    document.getElementById('submitButton').addEventListener('click', (e) => {
		    	e.preventDefault();
		    	let grade = document.getElementById("grade").value;
			    let comments = document.getElementById("comments").value;
		    	const reqBody = {grade,comments};
		    	const xhr0 = new XMLHttpRequest();
		    	xhr0.onreadystatechange = () => {
		    		if(xhr0.readyState === 4 && xhr0.status === 200) {
	    				let updateStatus = xhr0.responseText;
	    				if(updateStatus == 'true'){
	    					alert("Grade successfully submitted.");
	    					window.location.href = "assignment";
	    				}else{
	    					alert("Error: Grade not submitted.");
	    				}
		    		}
		    	};

		    	xhr0.open("POST", "grade-submission");
		    	xhr0.setRequestHeader("Content-Type", "application/json");
		    	xhr0.send(JSON.stringify(reqBody));
		    });
		</script>
	</body>
</html>