<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>I FOUND THIS CACHE!!!</title>

    <!-- OUR CUSTOM SCRIPTS -->
    <script type="text/javascript" src="scripts/scripts.js"></script>

    <!--  BOOTSTRAP -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <!-- AWS SDK -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.682.0.min.js"></script>

    <!-- Our stylesheet last to trump above CSS-->
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <div class="justify-content-center text-center">
        <h3>CURRENT ITEM IN GEOCACHE:</h3>
        <div id="cont_s3Img"></div>
        <a href="" onclick="closeWindow();">Is this not the same item in geocache? CLICK HERE</a>
      </div>
    </div>

    <!-- These are required for bootstrap JS/CSS dependencies-->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
    <!-- These are required for bootstrap JS/CSS dependencies-->

    <script>
      function getS3Image(url) {
        var params = {
          Bucket: "thatteamproject2imagesbucket",
          Key: url,
        };

        const albumBucketName = "thatteamproject2imagesbucket";
        AWS.config.region = "us-east-2"; // Region
        AWS.config.credentials = new AWS.CognitoIdentityCredentials({
          IdentityPoolId: "us-east-2:6e651cc5-c8ce-41f5-a60d-58696a4c6848",
        });
        // AWS.config.update({
        //   accessKeyId: "AKIAWUQFFTEUEOHBVH4L",
        //   secretAccessKey: "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",
        //   region: "us-east-2",
        // });
        var s3 = new AWS.S3({
          apiVersion: "2006-03-01",
          params: { Bucket: albumBucketName },
        });

        s3.getSignedUrl("getObject", params, function (err, url) {
          console.log("Your generated pre-signed URL is", url);
          var photo = "<img style='width:128px;height:128px;' src='" + url + "'/>";
          document.getElementById("cont_s3Img").innerHTML += photo;
        });

        // s3.getObject(params, function (err, data) {
        //   if (err) {
        //     console.log(err, err.stack);
        //   }
        //   // an error occurred
        //   else {
        //     console.log(data); // successful response
        //     var href = this.request.httpRequest.endpoint.href;
        //     var bucketUrl = href + albumBucketName + "/";

        //     //build photo object for HTML insertion
        //     var photos = data.Contents.map(function (photo) {
        //       var photoKey = photo.Key;
        //       var photoUrl = bucketUrl + encodeURIComponent(photoKey);

        //       return getHtml(["<div>", '<img style="width:128px;height:128px;" src="' + photoUrl + '"/>', "</div>"]);
        //     });

        //     //populate the image into the container for the page
        //     document.getElementById("cont_s3Img").innerHTML += getHtml(photos);
        //     // document.getElementById("cont_s3Img").src = url.replace(/^https:\/\//i, "http://");
        //   }
        // });
      }

      $(document).ready(function () {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const imgurl = urlParams.get("imgurl");
        const cacheid = urlParams.get("cacheid");
        getS3Image("imgUnknown.jpg");
      });
    </script>
  </body>
</html>
