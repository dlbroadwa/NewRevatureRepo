<!DOCTYPE html>
<html style="height: 100%">
<head>
	<meta charset="ISO-8859-1">
	<title>Write a review</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC7F1SuZwQap5axge9RY6t-cIyt-4-D7w8&libraries=places&callback=initAutocomplete" async defer></script>
</head>
	<body>
		<div style="margin: 30px 20px">
			<h2><u>Share your experiences with us!</u></h2>
			<input id="autocomplete" placeholder="Enter a location" type="text" style="width: 530px"/>
			<form enctype="multipart/form-data" action="../create_post" method="POST"><br>
				<table style="border: 1px solid black;">
					<tr>
						<td>Name:</td>
						<td colspan="3"><input class="readonly" id="location" name="location" style="width: 99%" required/></td>
					</tr>
				  	<tr>
					    <td>Street address:</td>
					    <td><input class="readonly" id="street_number" name="address"/></td>
					    <td><input class="readonly" id="route" name="route" style="width: 99%"/></td>
				  	</tr>
				  	<tr>
					    <td>City:</td>
					    <td colspan="3" style="width: 200px"><input class="readonly" id="locality" name="city" required/></td>
				  	</tr>
				  	<tr>
					    <td>State:</td>
					    <td><input class="readonly" id="administrative_area_level_1" name="state" required/></td>
					    <td>Zip code: <input class="readonly" id="postal_code" name="zip" required/></td>
				  	</tr>
				  	<tr>
					    <td>Country:</td>
					    <td><input class="readonly" id="country" name="country" required/></td>
				  	</tr>
				  	<tr>
					    <td>Latitude:</td>
					    <td><input class="readonly" id="latitude" name="latitude" required/></td>
					    <td>Longitude: <input class="readonly" id="longitude" name="longitude" required/></td>
				  	</tr>
				</table>
				<br>
				<label>Title:</label>
				<input type="text" name="title" required placeholder="Title"><br><br>
				<textarea name="body" rows="15" cols="35" required>Describe your experience...</textarea><br><br>
				<label>Rating:</label>
				<input type="number" min=1 max=5 step=1 name="rating" required><br><br>
				<label>Upload an image: </label>
				<input type="file" name="image" accept="image/*"><br><br>
				<input type="submit" value="Create Review">
			</form>
			<form action="blogMain.html">
				<input type="submit" value="Go back" style="margin-top: 5px">
			</form>
		</div>
		
	<script>
	
		$(".readonly").on('keydown paste', function(e) {
			e.preventDefault();
		});
	
		let placeSearch, autocomplete;
		
		let componentForm = {
			street_number: 'short_name',
			route: 'long_name',
			locality: 'long_name',
			sublocality_level_1: 'long_name',
			administrative_area_level_1: 'short_name',
			country: 'long_name',
			postal_code: 'short_name'
		};
		
		function initAutocomplete() {
			let options = {
				types: ['establishment'],
				componentRestrictions: {country: 'us'}
			}
			autocomplete = new google.maps.places.Autocomplete(document.getElementById('autocomplete'), options);
			autocomplete.setFields(['address_component', 'name', 'geometry']);
			autocomplete.addListener('place_changed', fillInAddress);
		}
		
		function fillInAddress() {
			let place = autocomplete.getPlace();
			
			for (var component in componentForm) {
				if (document.getElementById(component) != null)
					document.getElementById(component).value = '';
			}
			document.getElementById("location").value = '';
			document.getElementById("latitude").value = '';
			document.getElementById("longitude").value = '';

			for (let i = 0; i < place.address_components.length; i++) {
				let addressType = place.address_components[i].types[0];
				if (componentForm[addressType]) {
					let val = place.address_components[i][componentForm[addressType]];
					if (addressType == 'sublocality_level_1' && document.getElementById('locality').value == '') {
						document.getElementById('locality').value = val;
					} else if (addressType != 'sublocality_level_1') {
						document.getElementById(addressType).value = val;
					}
				}
			}
			document.getElementById("location").value = place.name;
			document.getElementById("latitude").value = place.geometry.location.lat();
			document.getElementById("longitude").value = place.geometry.location.lng();
		}
	</script>
	</body>
</html>